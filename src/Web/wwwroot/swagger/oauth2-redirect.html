<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>OAuth2 Redirect</title>
</head>
<body>
    <script>
        (function () {
            const params = new URLSearchParams(window.location.search);
            const code = params.get('code');  // The authorization code
            debugger;
            if (code) {
                // Set your client_id, client_secret, and redirect_uri
                const clientId = '44473283156-7op213480o9p3jagklfremnp8qunugm3.apps.googleusercontent.com';
                const clientSecret = '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';
                const redirectUri = 'https://localhost:5002/swagger/oauth2-redirect.html';  // Your redirect URI

                // Prepare the data to send to Google's token endpoint
                const tokenData = new URLSearchParams();
                tokenData.append('code', code);
                tokenData.append('client_id', clientId);
                tokenData.append('client_secret', clientSecret);
                tokenData.append('redirect_uri', redirectUri);
                tokenData.append('grant_type', 'authorization_code');

                // Make the POST request to Google's token endpoint
                fetch('https://oauth2.googleapis.com/token', {
                    method: 'POST',
                    body: tokenData
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.id_token && data.access_token) {
                            // Store the id_token and access_token in localStorage
                            localStorage.setItem('id_token', data.id_token);
                            localStorage.setItem('access_token', data.access_token);
                            console.log("✅ Tokens saved to localStorage");
                        } else {
                            console.error("❌ Failed to retrieve tokens");
                        }
                        // Redirect to Swagger UI after saving the tokens
                        window.location.href = "/swagger";
                    })
                    .catch(error => {
                        console.error("Error exchanging code:", error);
                    });
            } else {
                console.warn("Authorization code not found.");
            }
        })();
    </script>
</body>
</html>
